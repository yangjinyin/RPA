```c++
//所有table cache的集合，该对象有一个全局单例
class Table_cache_manager 
{
  static const int MAX_TABLE_CACHES = 64; //最多管理64个table cache
  Table_cache m_table_cache[MAX_TABLE_CACHES];
}

//维护了相关的几个THD所使用的所有table_cache_element，即所有正在使用或曾经打开过的TABLE对象
class Table_cache 
{
  TABLE *m_unused_tables; //所有table_cache_element中free_tables的并集
  std::unordered_map<std::string, std::unique_ptr<Table_cache_element>> m_cache; //
}

class Table_cache_element
{
  TABLE_list used_tables;								//
  TABLE_list free_tables;								//
  TABLE_SHARE *share;										//
}

//TABLE_SHARE为所有TABLE对象所共有
struct TABLE_SHARE
{
  Table_cache_element **cache_element{nullptr} 
  Field **field{nullptr};
  KEY *key_info{nullptr}; 
  ....
}

struct TABLE {
  TABLE_SHARE *s{nullptr};   
  handler *file{nullptr};
  TABLE *next{nullptr}, *prev{nullptr};

 private:
  TABLE *cache_next{nullptr}, **cache_prev{nullptr};

  /*
    Give table_cache_element access to the above two members to allow
    using them for linking TABLE objects in a list.
  */
  friend class table_cache_element;

 public:
 
  THD *in_use{nullptr};   /* Which thread uses this */
  Field **field{nullptr}; /* Pointer to fields */

  bool m_needs_reopen{false};

 }
```

<img src="/Users/yangjinyin/Desktop/table.png" alt="table" style="zoom:80%;" />